<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>EPOS2MotorController: TankSteering Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EPOS2MotorController
   </div>
   <div id="projectbrief">EPOS2 on Volksbot with ROS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Data&#160;Fields</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a>  </div>
  <div class="headertitle">
<div class="title">TankSteering Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>TankSteering-Class.  
 <a href="classTankSteering.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="TankSteering_8h_source.html">TankSteering.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTankSteering_1_1distanceStruct.html">distanceStruct</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">structure with all values to restrict the velocity depending on the laser-scanner-data.  <a href="structTankSteering_1_1distanceStruct.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTankSteering_1_1odom.html">odom</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">structure with all data to calculate the current position depending on odometry-data  <a href="structTankSteering_1_1odom.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTankSteering_1_1orientation.html">orientation</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">describing the orientation of the robot in a 2D-case depending to a parent-frame  <a href="structTankSteering_1_1orientation.html#details">More...</a><br/></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTankSteering_1_1tankSet.html">tankSet</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Settings Structure with all relevant values and ROS.  <a href="structTankSteering_1_1tankSet.html#details">More...</a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a115b224a4a448b49e1db1c8b99e5a014"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <b>left</b>, 
<b>right</b>
 }</td></tr>
<tr class="memdesc:a115b224a4a448b49e1db1c8b99e5a014"><td class="mdescLeft">&#160;</td><td class="mdescRight">enumeration for naming the EPOS2s <br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad7e373315c8b6b1993a67ff269dd4817"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#ad7e373315c8b6b1993a67ff269dd4817">TankSteering</a> (ros::NodeHandle roshandle, <a class="el" href="classEpos2MotorController.html">Epos2MotorController</a> *epos[2], double wheelPerimeter, double axisLength, double maxMPS, double odomDuration=0.05, double velocityDuration=0.07)</td></tr>
<tr class="memdesc:ad7e373315c8b6b1993a67ff269dd4817"><td class="mdescLeft">&#160;</td><td class="mdescRight">constructor of TankSteering-Class.  <a href="#ad7e373315c8b6b1993a67ff269dd4817"></a><br/></td></tr>
<tr class="memitem:a598a4efa2896aa382ed7fe9af6e22519"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a598a4efa2896aa382ed7fe9af6e22519">~TankSteering</a> ()</td></tr>
<tr class="memdesc:a598a4efa2896aa382ed7fe9af6e22519"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor of the TankSteering-class.  <a href="#a598a4efa2896aa382ed7fe9af6e22519"></a><br/></td></tr>
<tr class="memitem:ac07cb26cfc52f615863d6fdaef924131"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#ac07cb26cfc52f615863d6fdaef924131">initLaserscanner</a> (int range=180, double low=0.15, double high=0.6)</td></tr>
<tr class="memdesc:ac07cb26cfc52f615863d6fdaef924131"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialized the parameters for using the laser-scanner to avoid crashing into obstacles in front of the robot.  <a href="#ac07cb26cfc52f615863d6fdaef924131"></a><br/></td></tr>
<tr class="memitem:a89990f8796af8d4224752c0e0a0daf47"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a89990f8796af8d4224752c0e0a0daf47">sign</a> (double number)</td></tr>
<tr class="memdesc:a89990f8796af8d4224752c0e0a0daf47"><td class="mdescLeft">&#160;</td><td class="mdescRight">return if a value is positive, zero or negative  <a href="#a89990f8796af8d4224752c0e0a0daf47"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a1ee9bb43163695018d65f8dbda46c050"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a1ee9bb43163695018d65f8dbda46c050">driveCallbackMPS</a> (const epos2_control::velocity speed)</td></tr>
<tr class="memdesc:a1ee9bb43163695018d65f8dbda46c050"><td class="mdescLeft">&#160;</td><td class="mdescRight">velocity-Callback-function - will be called if a speed-message (velocity left and right) was sent  <a href="#a1ee9bb43163695018d65f8dbda46c050"></a><br/></td></tr>
<tr class="memitem:a7d071ca7df1b04000275255114d9ff63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a7d071ca7df1b04000275255114d9ff63">driveCallback</a> (const geometry_msgs::Twist velocityVector)</td></tr>
<tr class="memdesc:a7d071ca7df1b04000275255114d9ff63"><td class="mdescLeft">&#160;</td><td class="mdescRight">velocity-Callback-function - will be called if a twist message was sent  <a href="#a7d071ca7df1b04000275255114d9ff63"></a><br/></td></tr>
<tr class="memitem:ab1335cf95b773d0b8908d74ebb61c289"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#ab1335cf95b773d0b8908d74ebb61c289">setVelocityCallback</a> (const ros::TimerEvent &amp;event)</td></tr>
<tr class="memdesc:ab1335cf95b773d0b8908d74ebb61c289"><td class="mdescLeft">&#160;</td><td class="mdescRight">velocity-callback-function - every time called it will set the targetVelocity to both EPOS2  <a href="#ab1335cf95b773d0b8908d74ebb61c289"></a><br/></td></tr>
<tr class="memitem:ae19dbe86e3ae541c06525af2721a37dd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#ae19dbe86e3ae541c06525af2721a37dd">odomCallback</a> (const ros::TimerEvent &amp;event)</td></tr>
<tr class="memdesc:ae19dbe86e3ae541c06525af2721a37dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">odom-callback-function - reads out the current position of both motors connected to the EPOS2s and calculate the odometry-data  <a href="#ae19dbe86e3ae541c06525af2721a37dd"></a><br/></td></tr>
<tr class="memitem:a724c44b283936129841b91ecdcdb6235"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a724c44b283936129841b91ecdcdb6235">LaserScanCallback</a> (const sensor_msgs::LaserScan sensorData)</td></tr>
<tr class="memdesc:a724c44b283936129841b91ecdcdb6235"><td class="mdescLeft">&#160;</td><td class="mdescRight">laser-scanner-callback - will be called if the laser-scanner-node send new point-cloud-data  <a href="#a724c44b283936129841b91ecdcdb6235"></a><br/></td></tr>
<tr class="memitem:aed4cd5e319cd5c9cd95b835f1615eb0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#aed4cd5e319cd5c9cd95b835f1615eb0d">getDeviceErrorCallback</a> (const ros::TimerEvent &amp;event)</td></tr>
<tr class="memdesc:aed4cd5e319cd5c9cd95b835f1615eb0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">error-callback - will be called continuously and check both EPOS2 on Errors.  <a href="#aed4cd5e319cd5c9cd95b835f1615eb0d"></a><br/></td></tr>
<tr class="memitem:a32596c18de1130cad7e926e3182f12c4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a32596c18de1130cad7e926e3182f12c4">init</a> ()</td></tr>
<tr class="memdesc:a32596c18de1130cad7e926e3182f12c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialized both EPOS2 and setup all ROS components.  <a href="#a32596c18de1130cad7e926e3182f12c4"></a><br/></td></tr>
<tr class="memitem:a99aadf750c50610cfea8732f95e21426"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a99aadf750c50610cfea8732f95e21426">resetEPOS2Fault</a> ()</td></tr>
<tr class="memdesc:a99aadf750c50610cfea8732f95e21426"><td class="mdescLeft">&#160;</td><td class="mdescRight">bring the EPOS2 into a drive-able state.  <a href="#a99aadf750c50610cfea8732f95e21426"></a><br/></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a6973af1afc00c9b11f32ecc7ad7e8a14"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6973af1afc00c9b11f32ecc7ad7e8a14"></a>
struct <a class="el" href="structTankSteering_1_1tankSet.html">TankSteering::tankSet</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14">tankSettings</a></td></tr>
<tr class="memdesc:a6973af1afc00c9b11f32ecc7ad7e8a14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main Settings for tank-steering a robot with two EPOS2. <br/></td></tr>
<tr class="memitem:a63ff23d449dca437f90e16f3a3684c20"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a63ff23d449dca437f90e16f3a3684c20"></a>
struct <a class="el" href="structTankSteering_1_1distanceStruct.html">TankSteering::distanceStruct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20">LaserDistance</a></td></tr>
<tr class="memdesc:a63ff23d449dca437f90e16f3a3684c20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Settings to restrict the velocity in front of obstacles. <br/></td></tr>
<tr class="memitem:ae08d9f507d6de01a86f59aa135283abc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae08d9f507d6de01a86f59aa135283abc"></a>
struct <a class="el" href="structTankSteering_1_1odom.html">TankSteering::odom</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc">pos</a></td></tr>
<tr class="memdesc:ae08d9f507d6de01a86f59aa135283abc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Temporary memory for the odometry-calculation. <br/></td></tr>
</table>
<a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>TankSteering-Class. </p>
<p>It's used to control two EPOS2 while each one drive on side of a robot. Steering will be done by a difference between the velocities for both sides. </p>

<p>Definition at line <a class="el" href="TankSteering_8h_source.html#l00024">24</a> of file <a class="el" href="TankSteering_8h_source.html">TankSteering.h</a>.</p>
</div><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ad7e373315c8b6b1993a67ff269dd4817"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TankSteering::TankSteering </td>
          <td>(</td>
          <td class="paramtype">ros::NodeHandle&#160;</td>
          <td class="paramname"><em>roshandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classEpos2MotorController.html">Epos2MotorController</a> *&#160;</td>
          <td class="paramname"><em>epos</em>[2], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>wheelPerimeter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>axisLength</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>maxMPS</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>odomDuration</em> = <code>0.05</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>velocityDuration</em> = <code>0.07</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>constructor of TankSteering-Class. </p>
<p>Initialized all values without the laser-scanner-data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">roshandle</td><td>handle from ROS to open Timer, Subscriber and Publisher </td></tr>
    <tr><td class="paramname">epos</td><td>two instances of the Epos2MotorController-class. One for each side of the robot with the following order: left, right. </td></tr>
    <tr><td class="paramname">wheelPerimeter</td><td>[m] the perimeter of one wheel - all motor-driven wheels should have the same perimeter and radius </td></tr>
    <tr><td class="paramname">axisLength</td><td>[m] the distance between two wheels with the same axis of rotation (on opposite sites of the robot) </td></tr>
    <tr><td class="paramname">maxMPS</td><td>[m/s] highest allowed velocity of the robot </td></tr>
    <tr><td class="paramname">odomDuration</td><td>[s] the time between to calls of the <a class="el" href="classTankSteering.html#ae19dbe86e3ae541c06525af2721a37dd" title="odom-callback-function - reads out the current position of both motors connected to the EPOS2s and ca...">odomCallback()</a> </td></tr>
    <tr><td class="paramname">velocityDuration</td><td>[s] the time between to calls of the <a class="el" href="classTankSteering.html#ab1335cf95b773d0b8908d74ebb61c289" title="velocity-callback-function - every time called it will set the targetVelocity to both EPOS2...">setVelocityCallback()</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00012">12</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a> = maxMPS;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a9bef02225da9845d32bf5700ef132aba" title="[s] the time between to calls of the odomCallback()">odomDuration</a> = odomDuration;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a30ffc7283de96cfdf97cd987de2cad63" title="[s] the time between to calls of the setVelocityCallback()">velocityDuration</a> = velocityDuration;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a546f41c6c1e7d0ba11e7a096c41d52cd" title="[m] the distance between two wheels with the same axis of rotation (on opposite sites of the robot)...">axisLength</a> = axisLength;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a6876c0ad344c0baf2f63fbe8da846af1" title="[m] the perimeter of one wheel - all motor-driven wheels should have the same perimeter and radius...">wheelPerimeter</a> = wheelPerimeter;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a895d3b886f7c964e6eb2eb97c3254be0" title="[-] factor to convert a translational velocity (m/s) to an angular velocity (rev/min) depending on th...">factorMPSToRPM</a> = 60 / <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a6876c0ad344c0baf2f63fbe8da846af1" title="[m] the perimeter of one wheel - all motor-driven wheels should have the same perimeter and radius...">wheelPerimeter</a>;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0f3c7547f093cd0f8ca66016bca46cd2" title="[rev/min] highest allowed angular velocity of the robot">maxRPM</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a> * <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a895d3b886f7c964e6eb2eb97c3254be0" title="[-] factor to convert a translational velocity (m/s) to an angular velocity (rev/min) depending on th...">factorMPSToRPM</a>;</div>
<div class="line"></div>
<div class="line">    ROS_ERROR(<span class="stringliteral">&quot;TAnkSteering: maxMPS: %.4lf, factorMPSToRPM: %.4lf, maxRPM: %.4lf&quot;</span>, <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a>, <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a895d3b886f7c964e6eb2eb97c3254be0" title="[-] factor to convert a translational velocity (m/s) to an angular velocity (rev/min) depending on th...">factorMPSToRPM</a>, <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0f3c7547f093cd0f8ca66016bca46cd2" title="[rev/min] highest allowed angular velocity of the robot">maxRPM</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a> = roshandle;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right;i++) {</div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i] = epos[i];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a> = 0;</div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a>;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a32596c18de1130cad7e926e3182f12c4" title="Initialized both EPOS2 and setup all ROS components.">init</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a598a4efa2896aa382ed7fe9af6e22519"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TankSteering::~TankSteering </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destructor of the TankSteering-class. </p>
<p>Nothing to do by now. </p>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00037">37</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2>Member Function Documentation</h2>
<a class="anchor" id="a7d071ca7df1b04000275255114d9ff63"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::driveCallback </td>
          <td>(</td>
          <td class="paramtype">const geometry_msgs::Twist&#160;</td>
          <td class="paramname"><em>velocityVector</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>velocity-Callback-function - will be called if a twist message was sent </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">velocityVector</td><td>contains velocities in each direction of space and angular velocities around each axis </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00048">48</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> dxTarget = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a546f41c6c1e7d0ba11e7a096c41d52cd" title="[m] the distance between two wheels with the same axis of rotation (on opposite sites of the robot)...">axisLength</a> * velocityVector.angular.z / 2;</div>
<div class="line">    <span class="keywordtype">double</span> xTarget = velocityVector.linear.x;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//ROS_ERROR(&quot;linear.x: %.6f ; angular.z: %.6f&quot;, velocityVector.linear.x, velocityVector.angular.z); //debugging</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( fabs(<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a>) &gt; 0.01 ) {</div>
<div class="line">        <span class="comment">//forward velocity restriction</span></div>
<div class="line">        <span class="keywordflow">if</span> ( <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a> &lt; (fabs(dxTarget) + fabs(xTarget)) ) { xTarget = (<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a> - fabs(dxTarget)) * <a class="code" href="classTankSteering.html#a89990f8796af8d4224752c0e0a0daf47" title="return if a value is positive, zero or negative">sign</a>(xTarget); }</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> x = (xTarget &gt; <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a>) ? <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a> : xTarget;</div>
<div class="line"></div>
<div class="line">        <span class="comment">//rotation velocity restriction</span></div>
<div class="line">        <span class="keywordtype">double</span> dx = (fabs(dxTarget) &gt; <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a>) ? <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a> * <a class="code" href="classTankSteering.html#a89990f8796af8d4224752c0e0a0daf47" title="return if a value is positive, zero or negative">sign</a>(dxTarget) : dxTarget;</div>
<div class="line"></div>
<div class="line">        <span class="comment">//ROS_ERROR(&quot;x: %.4f ; dx: %.4f&quot;, x, dx);   //debugging</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">//output velocities</span></div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[left]  = x - dx;</div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[right] = x + dx;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ROS_ERROR(<span class="stringliteral">&quot;No movement possible because the maximum safety Velocity is to low.&quot;</span>);</div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[left]  = 0;</div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[right]  = 0;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1ee9bb43163695018d65f8dbda46c050"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::driveCallbackMPS </td>
          <td>(</td>
          <td class="paramtype">const epos2_control::velocity&#160;</td>
          <td class="paramname"><em>speed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>velocity-Callback-function - will be called if a speed-message (velocity left and right) was sent </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">speed</td><td>contains a velocity for each side of the robot </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00042">42</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[left] = speed.left;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[right] = speed.right;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aed4cd5e319cd5c9cd95b835f1615eb0d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::getDeviceErrorCallback </td>
          <td>(</td>
          <td class="paramtype">const ros::TimerEvent &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>error-callback - will be called continuously and check both EPOS2 on Errors. </p>
<p>if an error is detected both EPOS2 will be disable and afterwards reseted</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>contains some time values according to the event </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00194">194</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> error[2];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = left; i &lt;= right; i++) { error[i] = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a481615a590e6d1c6bf6c39c426e6d9a6" title="read out the error bit and the error history.">testForErrorsAndPrint</a>(); }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (error[left] == 0 || error[right] == 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = left; i &lt;= right; i++) { <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#ad58ad9fe38c72ce0d457a286973f8a99" title="set the EPOS2 into disable state">disableEpos2</a>();}</div>
<div class="line">        <a class="code" href="classTankSteering.html#a99aadf750c50610cfea8732f95e21426" title="bring the EPOS2 into a drive-able state.">resetEPOS2Fault</a>();</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a32596c18de1130cad7e926e3182f12c4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int TankSteering::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialized both EPOS2 and setup all ROS components. </p>
<dl class="section return"><dt>Returns</dt><dd>1 if successful otherwise 0 </dd></dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00206">206</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> j = 0;</div>
<div class="line">    <span class="keywordtype">int</span> active[2] = {0,0};</div>
<div class="line">    <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060c" title="internal state of the MotorController-Object with respect to the state of the EPOS2">Epos2MotorController::EposState</a> state = <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060caf0eea74682d3d3f21bec6e5b376cf443" title="EPOS2 is started but not ready for driving.">Epos2MotorController::disabled</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = left; i &lt;= right; i++) { <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a481615a590e6d1c6bf6c39c426e6d9a6" title="read out the error bit and the error history.">testForErrorsAndPrint</a>(); }</div>
<div class="line">    <a class="code" href="classTankSteering.html#a99aadf750c50610cfea8732f95e21426" title="bring the EPOS2 into a drive-able state.">resetEPOS2Fault</a>();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right;i++) {<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a0c2778ab028417b907d7a55297ccbd4a" title="calls a few set-functions, store the settings in the EPOS2 and enable the Device.">init</a>(<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0f3c7547f093cd0f8ca66016bca46cd2" title="[rev/min] highest allowed angular velocity of the robot">maxRPM</a>, <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a6876c0ad344c0baf2f63fbe8da846af1" title="[m] the perimeter of one wheel - all motor-driven wheels should have the same perimeter and radius...">wheelPerimeter</a>);}</div>
<div class="line">    ROS_INFO(<span class="stringliteral">&quot;initialize both EPOS2 successfully&quot;</span>);</div>
<div class="line"></div>
<div class="line">    j = 0;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[left]-&gt;<a class="code" href="classEpos2MotorController.html#ac6c31e0dc57485aa817431b22627fc70" title="read out the state of the EPOS2 state machine">getEpos2State</a>() == <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060cae6493e2426163b114bea951ab9a419d5" title="EPOS2 is ready for driving.">Epos2MotorController::enabled</a> &amp;&amp; <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[right]-&gt;<a class="code" href="classEpos2MotorController.html#ac6c31e0dc57485aa817431b22627fc70" title="read out the state of the EPOS2 state machine">getEpos2State</a>() == <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060cae6493e2426163b114bea951ab9a419d5" title="EPOS2 is ready for driving.">Epos2MotorController::enabled</a>) {</div>
<div class="line">            state = <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060cae6493e2426163b114bea951ab9a419d5" title="EPOS2 is ready for driving.">Epos2MotorController::enabled</a>;</div>
<div class="line">            <span class="keywordflow">if</span> (j == 0) { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right;i++) {<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#aeadc7a21fa6619a4104887f169b9d2fd" title="set the EPOS2 into enable state">enableEpos2</a>();} }</div>
<div class="line">        }</div>
<div class="line">        j++;</div>
<div class="line">    } <span class="keywordflow">while</span> ( state != <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060cae6493e2426163b114bea951ab9a419d5" title="EPOS2 is ready for driving.">Epos2MotorController::enabled</a> &amp;&amp; j &lt; 6);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (state == <a class="code" href="classEpos2MotorController.html#ab5ec630dfbb90ad674e311187926060cae6493e2426163b114bea951ab9a419d5" title="EPOS2 is ready for driving.">Epos2MotorController::enabled</a>) {</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right; i++) {</div>
<div class="line">            active[i] = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a4f3a4529154e01acb6a15ff94d5c9000" title="change the OperationMode of the EPOS2 into ProfileVelocityMode and set the MotionProfile to sin^2-ram...">activateProfileVelocity</a>();</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( active[left] == 1 &amp;&amp; active[right] == 1 ) {</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a060a7d28692189eb3fae35364a36af4c" title="object for listing to speed messages (one value for each side of the robot)">epos2MPS</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.subscribe(<span class="stringliteral">&quot;epos2_MPS_left_right&quot;</span>, 1000, &amp;<a class="code" href="classTankSteering.html#a1ee9bb43163695018d65f8dbda46c050" title="velocity-Callback-function - will be called if a speed-message (velocity left and right) was sent...">TankSteering::driveCallbackMPS</a>, <span class="keyword">this</span>);</div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a98ce962e2398504d19e9ec5d337b520f" title="object for listing to twist messages (cmd_vel)">epos2Twist</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.subscribe(<span class="stringliteral">&quot;cmd_vel&quot;</span>, 1000, &amp;<a class="code" href="classTankSteering.html#a7d071ca7df1b04000275255114d9ff63" title="velocity-Callback-function - will be called if a twist message was sent">TankSteering::driveCallback</a>, <span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right; i++) { <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a25a805ceeca36f85c91baaec605616d5" title="the last position of both motors connected to the EPOS2">lastPosition</a>[i]=<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a07b5def07609a91cba8a1977f6436c0a" title="read out the current position value depending on the start position.">getAbsolutePosition</a>() * <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a6876c0ad344c0baf2f63fbe8da846af1" title="[m] the perimeter of one wheel - all motor-driven wheels should have the same perimeter and radius...">wheelPerimeter</a>; }</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#aa0c689559cc4b8217b66d752ed9c5514" title="a timer object to call the function which calculates the current position">odomTimer</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.createTimer(ros::Duration(<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a9bef02225da9845d32bf5700ef132aba" title="[s] the time between to calls of the odomCallback()">odomDuration</a>), &amp;<a class="code" href="classTankSteering.html#ae19dbe86e3ae541c06525af2721a37dd" title="odom-callback-function - reads out the current position of both motors connected to the EPOS2s and ca...">TankSteering::odomCallback</a>, <span class="keyword">this</span>);</div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#acbbb0676b14d02706ad100abee4a22c8" title="a timer object to call the function which sets the current velocity value to the EPOS2">setVelocity</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.createTimer(ros::Duration(<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a30ffc7283de96cfdf97cd987de2cad63" title="[s] the time between to calls of the setVelocityCallback()">velocityDuration</a>), &amp;<a class="code" href="classTankSteering.html#ab1335cf95b773d0b8908d74ebb61c289" title="velocity-callback-function - every time called it will set the targetVelocity to both EPOS2...">TankSteering::setVelocityCallback</a>, <span class="keyword">this</span>);</div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a49304224faeac566fc964cbc98135499" title="object for sending the current position to the ROS NavStack">odomPub</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.advertise&lt;nav_msgs::Odometry&gt;(<span class="stringliteral">&quot;odom&quot;</span>, 50);</div>
<div class="line"></div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a729f2d8c93ceca1feee6dd6c7680e85a" title="a timer object to call a function which reads out both EPOS2 error historys">getErrorLoop</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.createTimer(ros::Duration(1.02), &amp;<a class="code" href="classTankSteering.html#aed4cd5e319cd5c9cd95b835f1615eb0d" title="error-callback - will be called continuously and check both EPOS2 on Errors.">TankSteering::getDeviceErrorCallback</a>, <span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">            ROS_INFO(<span class="stringliteral">&quot;Epos2-TankSteering is now listing for velocity messages&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            ROS_ERROR(<span class="stringliteral">&quot;at least one Epos2 is not in ProfileVelocityMode - no movement is possible&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        ROS_FATAL(<span class="stringliteral">&quot;Unable starting motors, the EPOS2 are not enabled. (Maybe Power-off or Unplugged?)&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }<span class="comment">//end of state is enable</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac07cb26cfc52f615863d6fdaef924131"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::initLaserscanner </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>range</em> = <code>180</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>low</em> = <code>0.15</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>high</em> = <code>0.6</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialized the parameters for using the laser-scanner to avoid crashing into obstacles in front of the robot. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">range</td><td>[degree] the angle on which laser-scanner-data will be checked on obstacles </td></tr>
    <tr><td class="paramname">low</td><td>[m] the distance with velocity 0 m/s </td></tr>
    <tr><td class="paramname">high</td><td>[m] the distance where the restriction of velocity starts </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00260">260</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="comment">//sicklmsCounter=0; //testing laser-scanner</span></div>
<div class="line">    <span class="keywordtype">int</span> n=3;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a> = low;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a4c297988074a426bbfd0e489e450a9e4" title="[m] the distance with velocity 0 m/s">high</a> = high;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3c3fec327c3233ffc23ad60179f8cec9" title="[degree] the angle on which laser-scanner-data will be checked on obstacles">range</a> = range;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3d27444d897b76c5fd31b3562938ec50" title="the factor before the x^2">a</a> = 2 * <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a> * (n - 2) / ( n * pow((<a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a> - <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a4c297988074a426bbfd0e489e450a9e4" title="[m] the distance with velocity 0 m/s">high</a>),2) );</div>
<div class="line">    <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a5fab2689bfcfa0c34b03c9e5adfc540f" title="the factor before the x">b</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a> / (<a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a4c297988074a426bbfd0e489e450a9e4" title="[m] the distance with velocity 0 m/s">high</a> - <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a>) - <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3d27444d897b76c5fd31b3562938ec50" title="the factor before the x^2">a</a> * (<a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a> + <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a4c297988074a426bbfd0e489e450a9e4" title="[m] the distance with velocity 0 m/s">high</a>);</div>
<div class="line">    <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a057147d8925b80f772f8e299067248a8" title="the absolute value of the equation">c</a> = -1 * (<a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3d27444d897b76c5fd31b3562938ec50" title="the factor before the x^2">a</a> * pow(<a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a>,2) + <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a5fab2689bfcfa0c34b03c9e5adfc540f" title="the factor before the x">b</a> * <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a6c3c336a6adc81a2ec23389d5a6f69c4" title="a object for listing to point-cloud-messages from the laser scanner">sickLMS</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a56100d71c75a60b1bee858cac36bd28b" title="the handle on a ROSNode to open Timers, Subscribers, Publishers...">roshandle</a>.subscribe(<span class="stringliteral">&quot;scan&quot;</span>, 100, &amp;<a class="code" href="classTankSteering.html#a724c44b283936129841b91ecdcdb6235" title="laser-scanner-callback - will be called if the laser-scanner-node send new point-cloud-data">TankSteering::LaserScanCallback</a>, <span class="keyword">this</span>);</div>
<div class="line"></div>
<div class="line">    ROS_ERROR(<span class="stringliteral">&quot;Laser-Scanner successfully initialized (Parameter-&gt; a: %.4lf, b: %.4lf, c: %.4lf)&quot;</span>, <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3d27444d897b76c5fd31b3562938ec50" title="the factor before the x^2">a</a>, <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a5fab2689bfcfa0c34b03c9e5adfc540f" title="the factor before the x">b</a>, <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a057147d8925b80f772f8e299067248a8" title="the absolute value of the equation">c</a>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a724c44b283936129841b91ecdcdb6235"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::LaserScanCallback </td>
          <td>(</td>
          <td class="paramtype">const sensor_msgs::LaserScan&#160;</td>
          <td class="paramname"><em>sensorData</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>laser-scanner-callback - will be called if the laser-scanner-node send new point-cloud-data </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sensorData</td><td>contains all points measured by the laser-scanner and the distance </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00163">163</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> minValue = sensorData.range_max;</div>
<div class="line">    <span class="keywordtype">int</span> points = 0, start = 0;</div>
<div class="line"></div>
<div class="line">    points = ( abs(sensorData.ranges.size()) &gt; 180 ) ? 180 : abs(sensorData.ranges.size());</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (points &gt; <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3c3fec327c3233ffc23ad60179f8cec9" title="[degree] the angle on which laser-scanner-data will be checked on obstacles">range</a>) {</div>
<div class="line">        start = (int)((points - <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3c3fec327c3233ffc23ad60179f8cec9" title="[degree] the angle on which laser-scanner-data will be checked on obstacles">range</a>) / 2);  <span class="comment">//quick &amp; dirty ... only produce even ranges - if LaserDistance.range is uneven it behaves the same as the next lower even integer</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=start; i&lt;points-start; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (sensorData.ranges[i] &lt; minValue) {minValue = sensorData.ranges[i];}</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (minValue &lt; <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a4c297988074a426bbfd0e489e450a9e4" title="[m] the distance with velocity 0 m/s">high</a>) {</div>
<div class="line">        <span class="keywordflow">if</span> (minValue &gt; <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a457ba78027c23e665b5d16909872cc81" title="[m] the distance where the restriction of velocity starts">low</a>) {</div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a> = <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a3d27444d897b76c5fd31b3562938ec50" title="the factor before the x^2">a</a> * pow(minValue,2) + <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a5fab2689bfcfa0c34b03c9e5adfc540f" title="the factor before the x">b</a> * minValue + <a class="code" href="classTankSteering.html#a63ff23d449dca437f90e16f3a3684c20" title="Settings to restrict the velocity in front of obstacles.">LaserDistance</a>.<a class="code" href="structTankSteering_1_1distanceStruct.html#a057147d8925b80f772f8e299067248a8" title="the absolute value of the equation">c</a>;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a> = 0;</div>
<div class="line">        }</div>
<div class="line">    }<span class="keywordflow">else</span>{</div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#ab604472ee21a35336e7be92ed0a9616f" title="[m/s] highest allowed velocity if a connected laser scanner detect obstacles in sight.">maxSafetyMPS</a> = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a07b9b99e1d4d281a8ffc6cca8cebfcfa" title="[m/s] highest allowed velocity of the robot">maxMPS</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*if (sicklmsCounter &gt;= 20) {</span></div>
<div class="line"><span class="comment">        sicklmsCounter=0;</span></div>
<div class="line"><span class="comment">        ROS_ERROR(&quot;seq: %i, Nearest: %.4lf, maxVel: %.4lf, VelTrans: %.4lf, VelRot: %.4lf&quot;, sensorData.header.seq, minValue, maxSafetyForwardVelocity, cmdVelTimerSet.x, cmdVelTimerSet.dx);</span></div>
<div class="line"><span class="comment">    }*/</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae19dbe86e3ae541c06525af2721a37dd"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::odomCallback </td>
          <td>(</td>
          <td class="paramtype">const ros::TimerEvent &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>odom-callback-function - reads out the current position of both motors connected to the EPOS2s and calculate the odometry-data </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>contains some time values according to the event </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00088">88</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> pos_linear_z=0;</div>
<div class="line">    <span class="keywordtype">double</span> pos_delta[2], temp_pos[2];</div>
<div class="line">    tf::StampedTransform readTransform;</div>
<div class="line">    geometry_msgs::TransformStamped transform;</div>
<div class="line">    nav_msgs::Odometry nav_odom;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right; i++) { temp_pos[i] = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a07b5def07609a91cba8a1977f6436c0a" title="read out the current position value depending on the start position.">getAbsolutePosition</a>() * <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a6876c0ad344c0baf2f63fbe8da846af1" title="[m] the perimeter of one wheel - all motor-driven wheels should have the same perimeter and radius...">wheelPerimeter</a>; }</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right; i++) {</div>
<div class="line">        pos_delta[i] = temp_pos[i] - <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a25a805ceeca36f85c91baaec605616d5" title="the last position of both motors connected to the EPOS2">lastPosition</a>[i];</div>
<div class="line">        <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a25a805ceeca36f85c91baaec605616d5" title="the last position of both motors connected to the EPOS2">lastPosition</a>[i] = temp_pos[i];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">float</span> timeDelta = (<span class="keyword">event</span>.current_real - <span class="keyword">event</span>.last_real).toSec();</div>
<div class="line">    <span class="keywordtype">double</span> polar_s  =(pos_delta[right] + pos_delta[left] ) * 0.5;</div>
<div class="line">    <span class="keywordtype">double</span> polar_theta=(pos_delta[right] - pos_delta[left]) / <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a546f41c6c1e7d0ba11e7a096c41d52cd" title="[m] the distance between two wheels with the same axis of rotation (on opposite sites of the robot)...">axisLength</a>;</div>
<div class="line">    <span class="keywordtype">double</span> delta_r = (polar_theta == 0) ? polar_s : (polar_s / polar_theta) * sin(polar_theta/2) * 2;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a2df52ee5bd9169dad2bd8c70d054cf74" title="object to get coordinate transformations from tf-framework">tfListener</a>.lookupTransform(<span class="stringliteral">&quot;/odom&quot;</span>, <span class="stringliteral">&quot;/base_link&quot;</span>, ros::Time(0), readTransform);</div>
<div class="line">        <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a> = readTransform.getOrigin().x();</div>
<div class="line">        <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a> = readTransform.getOrigin().y();</div>
<div class="line">        <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a> = tf::getYaw(readTransform.getRotation());</div>
<div class="line">    } <span class="keywordflow">catch</span> (tf::TransformException ex) {</div>
<div class="line">        ROS_ERROR(<span class="stringliteral">&quot;%s&quot;</span>,ex.what());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a> + delta_r * cos(polar_theta/2 + <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a>);</div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a> + delta_r * sin(polar_theta/2 + <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a>);</div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a> + polar_theta;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//odom</span></div>
<div class="line">    geometry_msgs::Quaternion odom_quat = tf::createQuaternionMsgFromYaw(<a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a>);</div>
<div class="line"></div>
<div class="line">    transform.header.stamp = <span class="keyword">event</span>.current_real;</div>
<div class="line">    transform.header.frame_id = <span class="stringliteral">&quot;odom&quot;</span>;</div>
<div class="line">    transform.child_frame_id = <span class="stringliteral">&quot;base_link&quot;</span>;</div>
<div class="line"></div>
<div class="line">    transform.transform.translation.x = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a>;</div>
<div class="line">    transform.transform.translation.y = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a>;</div>
<div class="line">    transform.transform.translation.z = pos_linear_z;</div>
<div class="line">    transform.transform.rotation = odom_quat;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a24fcf593e4c92d8abfd5444e1206807b" title="object to send coordinates with respective to a given system to the tf-frameork">tfBroad</a>.sendTransform(transform);</div>
<div class="line"></div>
<div class="line">    nav_odom.header.stamp = <span class="keyword">event</span>.current_real;</div>
<div class="line">    nav_odom.header.frame_id = <span class="stringliteral">&quot;odom&quot;</span>;</div>
<div class="line">    nav_odom.pose.pose.position.x = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a>;</div>
<div class="line">    nav_odom.pose.pose.position.y = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a>;</div>
<div class="line">    nav_odom.pose.pose.position.z = pos_linear_z;</div>
<div class="line">    nav_odom.pose.pose.orientation = odom_quat;</div>
<div class="line">    nav_odom.twist.twist.linear.x = polar_s / timeDelta;</div>
<div class="line">    nav_odom.twist.twist.linear.y = 0;</div>
<div class="line">    nav_odom.twist.twist.linear.z = 0;</div>
<div class="line">    nav_odom.twist.twist.angular.x = 0;</div>
<div class="line">    nav_odom.twist.twist.angular.y = 0;</div>
<div class="line">    nav_odom.twist.twist.angular.z = polar_theta / timeDelta;</div>
<div class="line">    <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a49304224faeac566fc964cbc98135499" title="object for sending the current position to the ROS NavStack">odomPub</a>.publish(nav_odom);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#af121cb548f0f9fcfc8a294654b1ceb85" title="the x-coordinate">x</a>;</div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a6fa34c399e16ffa4c8b8145126c6c9bf" title="the y-coordinate">y</a>;</div>
<div class="line">    <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#ae6353ef712a0b7bc9c783d77229d2221" title="the position one step before">last</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a> = <a class="code" href="classTankSteering.html#ae08d9f507d6de01a86f59aa135283abc" title="Temporary memory for the odometry-calculation.">pos</a>.<a class="code" href="structTankSteering_1_1odom.html#a20be7326384f778c008d55a0d304f0ab" title="the current position">now</a>.<a class="code" href="structTankSteering_1_1orientation.html#a9e0356a869ea75261e37e089262cc5e8" title="the rotation of the robot">theta</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//ROS_ERROR(&quot;last pos (x, y, phi): %.4lf, %.4lf, %.4lf&quot;, pos.last.x, pos.last.y, pos.last.theta);</span></div>
<div class="line">    <span class="comment">//ROS_ERROR(&quot;new pos (x, y, phi): %.4lf, %.4lf, %.4lf&quot;, pos.now.x, pos.now.y, pos.now.theta);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//ROS_INFO(&quot;velocity left:  %.4f  and right:  %.4f&quot;,  ((float)(pos_delta[left] )/timeDelta), ((float)(pos_delta[right])/timeDelta) );</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//float odomTime = (ros::Time::now() - event.current_real).toSec();</span></div>
<div class="line">    <span class="comment">//ROS_DEBUG(&quot;time taken by odom: %.5f sec&quot;, odomTime);</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//sicklmsCounter++; //testing laserscanner</span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a99aadf750c50610cfea8732f95e21426"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::resetEPOS2Fault </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>bring the EPOS2 into a drive-able state. </p>
<p>this function first reset both EPOS2 and clear afterwards the error history. </p>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00278">278</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right;i++) {<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a257e06f445d5ecc34f1dbae30e63fc9f" title="Reset the State Machine inside the EPOS2.">resetDevice</a>();}</div>
<div class="line">    ROS_INFO(<span class="stringliteral">&quot;reset EPOS2 successfully&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right;i++) {<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a07446045b12515427feda98fea36dab2" title="Delete all errors in the Error history of this EPOS2.">clearFault</a>();}</div>
<div class="line">    ROS_INFO(<span class="stringliteral">&quot;clear EPOS2 fault successfully&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab1335cf95b773d0b8908d74ebb61c289"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void TankSteering::setVelocityCallback </td>
          <td>(</td>
          <td class="paramtype">const ros::TimerEvent &amp;&#160;</td>
          <td class="paramname"><em>event</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>velocity-callback-function - every time called it will set the targetVelocity to both EPOS2 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">event</td><td>contains some time values according to the event </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00076">76</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> targetVelocityRPM[2];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right; i++) {targetVelocityRPM[i] = <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a895d3b886f7c964e6eb2eb97c3254be0" title="[-] factor to convert a translational velocity (m/s) to an angular velocity (rev/min) depending on th...">factorMPSToRPM</a> * <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[i];}</div>
<div class="line"></div>
<div class="line">    ROS_DEBUG(<span class="stringliteral">&quot;Try to set Velocity left to %.3f rpm and right to %.3f rpm&quot;</span>, targetVelocityRPM[left], targetVelocityRPM[right]);</div>
<div class="line">    ROS_INFO(<span class="stringliteral">&quot;Try to set Velocity left to %.4f m/s and right to %.4f m/s&quot;</span>, <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[left], <a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a21505f9f26ad6444c89d0795d35a5127" title="[m/s] the target velocity for both sides">targetVelocityMPS</a>[right]);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=left; i&lt;=right; i++) {<a class="code" href="classTankSteering.html#a6973af1afc00c9b11f32ecc7ad7e8a14" title="Main Settings for tank-steering a robot with two EPOS2.">tankSettings</a>.<a class="code" href="structTankSteering_1_1tankSet.html#a0c1ff021afbf7602a5593ca973b25246" title="two instances of the Epos2MotorController class - one for each side (left/right)">epos</a>[i]-&gt;<a class="code" href="classEpos2MotorController.html#a1b97f5c8fe0c7e2ff3256334c19b7a39" title="set a target angular velocity for this EPOS2.">changeRotationPerMinute</a>(targetVelocityRPM[i]);}</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a89990f8796af8d4224752c0e0a0daf47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int TankSteering::sign </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>number</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>return if a value is positive, zero or negative </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">number</td><td>the value which should be analyzed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>"-1" if negative, "0" if zero and "1" if positive </dd></dl>

<p>Definition at line <a class="el" href="TankSteering_8cpp_source.html#l00286">286</a> of file <a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (number&gt;0) ? 1 : (number&lt;0) ? -1 : 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/epos2_control/src/<a class="el" href="TankSteering_8h_source.html">TankSteering.h</a></li>
<li>src/epos2_control/src/<a class="el" href="TankSteering_8cpp_source.html">TankSteering.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 16 2013 18:18:40 for EPOS2MotorController by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
